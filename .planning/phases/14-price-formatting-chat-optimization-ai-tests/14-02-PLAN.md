---
phase: 14-price-formatting-chat-optimization-ai-tests
plan: 02
type: execute
wave: 2
depends_on: ["14-01"]
files_modified:
  - apps/web/app/(app)/components/ride-card.tsx
  - apps/web/app/(app)/components/ride-detail.tsx
  - apps/web/app/(app)/components/ride-form.tsx
  - apps/web/app/(app)/components/edit-ride-form.tsx
  - apps/web/app/(app)/my-rides/page.tsx
  - apps/web/app/(app)/search/page.tsx
  - apps/web/app/(app)/events/[id]/event-detail.tsx
  - apps/web/app/(app)/routes/[id]/route-detail.tsx
  - apps/web/app/(app)/routes/route-intent-list.tsx
  - apps/web/app/(app)/routes/new/route-intent-form.tsx
  - apps/web/app/(app)/assistant/components/intent-confirmation.tsx
  - apps/web/app/(app)/impact/impact-dashboard.tsx
  - apps/web/app/(public)/ride/[shortId]/page.tsx
  - apps/web/app/(app)/rides/[id]/page.tsx
  - apps/web/app/page.tsx
  - apps/web/app/(app)/rides/new/recurring/page.tsx
  - apps/web/__tests__/seo.test.ts
autonomous: true
requirements: [PRICE-01, PRICE-03]

must_haves:
  truths:
    - "All price displays across the app use formatPrice() instead of inline string concatenation"
    - "No remaining '${price} CZK' or '{price} Kc' patterns in user-facing components"
    - "Price slider on ride creation form shows the current value prominently below the slider"
    - "OG/SEO metadata price strings use formatPrice with appropriate formatting"
  artifacts:
    - path: "apps/web/app/(app)/components/ride-form.tsx"
      provides: "Price slider with value displayed below and formatPrice usage"
      contains: "formatPrice"
    - path: "apps/web/app/(app)/components/ride-card.tsx"
      provides: "Ride card with locale-aware price display"
      contains: "formatPrice"
  key_links:
    - from: "apps/web/app/(app)/components/ride-card.tsx"
      to: "packages/shared/src/utils/format-price.ts"
      via: "import from @festapp/shared"
      pattern: "import.*formatPrice.*@festapp/shared"
    - from: "apps/web/app/(app)/components/ride-form.tsx"
      to: "packages/shared/src/utils/format-price.ts"
      via: "import from @festapp/shared"
      pattern: "import.*formatPrice.*@festapp/shared"
---

<objective>
Replace all inline price formatting with formatPrice() across the entire app and add a prominent price value display below the ride creation slider.

Purpose: Ensure consistent locale-aware CZK formatting everywhere prices appear, and improve the ride creation UX by showing the selected price prominently below the slider (PRICE-03).
Output: All 17+ files displaying prices use formatPrice(). Slider value displayed below the range input.
</objective>

<execution_context>
@/Users/miakh/.claude/get-shit-done/workflows/execute-plan.md
@/Users/miakh/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-price-formatting-chat-optimization-ai-tests/14-RESEARCH.md
@.planning/phases/14-price-formatting-chat-optimization-ai-tests/14-01-SUMMARY.md
@packages/shared/src/utils/format-price.ts
@apps/web/app/(app)/components/ride-form.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace inline price formatting in all display files with formatPrice()</name>
  <files>
    apps/web/app/(app)/components/ride-card.tsx
    apps/web/app/(app)/components/ride-detail.tsx
    apps/web/app/(app)/components/edit-ride-form.tsx
    apps/web/app/(app)/my-rides/page.tsx
    apps/web/app/(app)/search/page.tsx
    apps/web/app/(app)/events/[id]/event-detail.tsx
    apps/web/app/(app)/routes/[id]/route-detail.tsx
    apps/web/app/(app)/routes/route-intent-list.tsx
    apps/web/app/(app)/routes/new/route-intent-form.tsx
    apps/web/app/(app)/assistant/components/intent-confirmation.tsx
    apps/web/app/(app)/impact/impact-dashboard.tsx
    apps/web/app/(public)/ride/[shortId]/page.tsx
    apps/web/app/(app)/rides/[id]/page.tsx
    apps/web/app/page.tsx
    apps/web/app/(app)/rides/new/recurring/page.tsx
    apps/web/__tests__/seo.test.ts
  </files>
  <action>
For each file listed, perform these replacements:

1. Add `import { formatPrice } from "@festapp/shared";` at the top (or add formatPrice to existing @festapp/shared import).

2. Replace each inline price pattern. The research identifies these patterns:
   - `${ride.price_czk} CZK` -> `formatPrice(ride.price_czk)`
   - `${price} CZK` -> `formatPrice(price)`
   - `'Free'` / `"Free"` fallback -> handled by formatPrice (returns "Zdarma" for 0/null)
   - `{value} CZK` -> `formatPrice(value)`
   - `${impact?.total_money_saved_czk ?? 0} CZK` -> `formatPrice(impact?.total_money_saved_czk)`
   - `{routeInfo.suggestedPriceCzk} {PRICING.CURRENCY_SYMBOL}` -> `formatPrice(routeInfo.suggestedPriceCzk)`
   - `Suggested: ${routeInfo.suggestedPriceCzk}` -> `` `Suggested: ${formatPrice(routeInfo.suggestedPriceCzk)}` ``

3. For **ternary patterns** like `ride.price_czk != null ? \`${ride.price_czk} CZK\` : 'Free'`, replace the entire ternary with `formatPrice(ride.price_czk)` since formatPrice handles null/0 -> "Zdarma".

4. If a file uses `PRICING.CURRENCY_SYMBOL` only for price display (not in slider min/max), the import of PRICING.CURRENCY_SYMBOL can be removed if no longer used.

5. For **OG/SEO metadata** in `rides/[id]/page.tsx` and `ride/[shortId]/page.tsx`: use formatPrice with default locale since these are server-rendered for crawlers. The "Kc" character renders fine in meta tags.

6. For **test assertions** in `seo.test.ts`: update expected strings to match formatPrice output (e.g., "150 Kc" format instead of "150 CZK").

7. For **edit-ride-form.tsx**: same pattern as ride-form.tsx -- replace `{PRICING.CURRENCY_SYMBOL}` with formatPrice calls.

**IMPORTANT:** Do NOT change the ride-form.tsx slider min/max/value display here -- Task 2 handles that file specifically. Only update edit-ride-form.tsx and other files in this task.
  </action>
  <verify>
    Run `grep -rn 'CZK\|CURRENCY_SYMBOL' apps/web/app --include='*.tsx' --include='*.ts' | grep -v node_modules | grep -v formatPrice | grep -v '.test.' | grep -v 'currency.*CZK'` to find any remaining inline price formatting. The only allowed remaining matches should be: the PRICING constant definition itself, currency configuration objects, and test files (which are updated separately).
  </verify>
  <done>All 16 non-ride-form files use formatPrice() for price display. No remaining inline `${price} CZK` or `CURRENCY_SYMBOL` concatenation in user-facing components. SEO test assertions updated.</done>
</task>

<task type="auto">
  <name>Task 2: Add prominent price value below slider on ride-form.tsx</name>
  <files>apps/web/app/(app)/components/ride-form.tsx</files>
  <action>
Modify `ride-form.tsx` lines 697-718 (the price slider section inside the Controller render prop):

1. Replace all `{PRICING.CURRENCY_SYMBOL}` with `formatPrice()` calls in the slider section.
2. Add `import { formatPrice } from "@festapp/shared";` (or add to existing import).
3. **Restructure the slider display** to show the current value prominently BELOW the slider:

Current layout:
```
[slider]
[min --- value --- max]
```

New layout (PRICE-03):
```
[slider]
[min --------- max]       <- smaller, text-secondary
[   CURRENT VALUE   ]     <- large, bold, centered below
```

Implementation:
```tsx
<div className="space-y-2">
  <input
    id="price"
    type="range"
    step={10}
    min={priceRange.min}
    max={priceRange.max}
    value={field.value ?? routeInfo?.suggestedPriceCzk ?? 0}
    onChange={(e) => field.onChange(Number(e.target.value))}
    className="w-full accent-primary"
  />
  <div className="flex items-center justify-between text-xs text-text-secondary">
    <span>{formatPrice(priceRange.min)}</span>
    <span>{formatPrice(priceRange.max)}</span>
  </div>
  <p className="text-center text-2xl font-bold text-primary">
    {formatPrice(field.value ?? 0)}
  </p>
</div>
```

4. Also replace the suggested price display earlier in ride-form.tsx (around line 552, 689) with formatPrice():
   - `{routeInfo.suggestedPriceCzk} {PRICING.CURRENCY_SYMBOL}` -> `{formatPrice(routeInfo.suggestedPriceCzk)}`

5. If PRICING import is no longer needed (all CURRENCY_SYMBOL usages replaced), remove it. Keep PRICING import if still used for other constants in the file (likely for MIN_PRICE_CZK or similar).
  </action>
  <verify>
    Run `grep -n 'CURRENCY_SYMBOL' apps/web/app/(app)/components/ride-form.tsx` -- should return zero matches. Run `grep -n 'formatPrice' apps/web/app/(app)/components/ride-form.tsx` -- should return multiple matches. Visual check: the slider section should show value below in text-2xl font-bold.
  </verify>
  <done>ride-form.tsx uses formatPrice() for all price displays. Price value appears below slider in large bold text (text-2xl font-bold text-primary, centered). Min/max shown as smaller labels flanking the slider. No remaining CURRENCY_SYMBOL concatenation.</done>
</task>

</tasks>

<verification>
1. `grep -rn 'CZK' apps/web/app --include='*.tsx' | grep -v formatPrice | grep -v node_modules | grep -v 'currency.*CZK' | grep -v CURRENCY` returns no inline price formatting
2. `grep -rn 'CURRENCY_SYMBOL' apps/web/app --include='*.tsx' | grep -v node_modules` returns zero matches (all replaced by formatPrice)
3. ride-form.tsx has `text-2xl font-bold` on the price value below the slider
4. TypeScript compiles: `npx turbo run typecheck --filter=web`
</verification>

<success_criteria>
- Zero inline `${price} CZK` or `CURRENCY_SYMBOL` concatenation patterns remain in user-facing components
- All 17+ files import and use formatPrice() from @festapp/shared
- ride-form.tsx shows the selected price in large bold text centered below the slider
- SEO test assertions match formatPrice output format
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/14-price-formatting-chat-optimization-ai-tests/14-02-SUMMARY.md`
</output>
