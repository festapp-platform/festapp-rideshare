---
phase: 01-foundation-auth
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - pnpm-workspace.yaml
  - .npmrc
  - turbo.json
  - tsconfig.base.json
  - .gitignore
  - apps/web/package.json
  - apps/web/next.config.ts
  - apps/web/tsconfig.json
  - apps/web/app/layout.tsx
  - apps/web/app/page.tsx
  - apps/mobile/package.json
  - apps/mobile/app.json
  - apps/mobile/tsconfig.json
  - apps/mobile/babel.config.js
  - apps/mobile/metro.config.js
  - apps/mobile/tailwind.config.js
  - apps/mobile/nativewind-env.d.ts
  - apps/mobile/app/_layout.tsx
  - apps/mobile/app/index.tsx
  - packages/shared/package.json
  - packages/shared/tsconfig.json
  - packages/shared/src/index.ts
  - packages/shared/src/validation/auth.ts
  - packages/shared/src/constants/auth.ts
  - packages/config/package.json
  - packages/config/typescript/base.json
  - .github/workflows/ci.yml
autonomous: true
must_haves:
  truths:
    - "pnpm install succeeds from clean checkout"
    - "pnpm turbo build compiles all packages without errors"
    - "apps/web dev server starts and renders a page"
    - "apps/mobile Expo dev server starts without Metro errors"
    - "packages/shared exports are importable from both apps"
    - "CI pipeline runs lint, typecheck, build on push"
  artifacts:
    - path: "package.json"
      provides: "Root workspace config with turbo scripts"
    - path: "pnpm-workspace.yaml"
      provides: "Workspace package glob"
    - path: ".npmrc"
      provides: "node-linker=hoisted for Expo compatibility"
    - path: "turbo.json"
      provides: "Turborepo task pipeline"
    - path: "packages/shared/src/index.ts"
      provides: "Barrel export for shared types, validation, constants"
    - path: "packages/shared/src/validation/auth.ts"
      provides: "Zod schemas for phone, email, OTP validation"
    - path: "apps/web/app/layout.tsx"
      provides: "Next.js root layout"
    - path: "apps/mobile/app/_layout.tsx"
      provides: "Expo root layout"
    - path: ".github/workflows/ci.yml"
      provides: "CI pipeline (TEST-10)"
  key_links:
    - from: "apps/web/package.json"
      to: "packages/shared"
      via: "workspace:* dependency"
      pattern: "@festapp/shared.*workspace"
    - from: "apps/mobile/package.json"
      to: "packages/shared"
      via: "workspace:* dependency"
      pattern: "@festapp/shared.*workspace"
    - from: "turbo.json"
      to: "package.json scripts"
      via: "task pipeline"
      pattern: "dependsOn.*\\^build"
---

<objective>
Scaffold the pnpm + Turborepo monorepo with Next.js 16 web app, Expo SDK 54 mobile app, shared TypeScript package, and CI pipeline.

Purpose: Establish the project foundation that all subsequent plans build on. Without this, nothing else can start.
Output: Working monorepo where both apps compile, import from shared package, and CI runs on PRs.
</objective>

<execution_context>
@/Users/miakh/.claude/get-shit-done/workflows/execute-plan.md
@/Users/miakh/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-auth/01-RESEARCH.md
@.planning/research/FESTAPP_PATTERNS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create monorepo structure with root config, shared package, and config package</name>
  <files>
    package.json
    pnpm-workspace.yaml
    .npmrc
    turbo.json
    tsconfig.base.json
    .gitignore
    packages/shared/package.json
    packages/shared/tsconfig.json
    packages/shared/src/index.ts
    packages/shared/src/types/database.ts
    packages/shared/src/validation/auth.ts
    packages/shared/src/constants/auth.ts
    packages/config/package.json
    packages/config/typescript/base.json
  </files>
  <action>
    Create root package.json with name "festapp-rideshare", private: true, scripts: { dev, build, lint, typecheck, test } all running `turbo` commands. Engine: node >=20, pnpm >=9.

    Create pnpm-workspace.yaml with packages: ['apps/*', 'packages/*'].

    Create .npmrc with `node-linker=hoisted` (CRITICAL for Expo + pnpm -- Metro cannot resolve symlinked packages).

    Create turbo.json following the exact pattern from research:
    - build: dependsOn ["^build"], outputs [".next/**", "!.next/cache/**", "dist/**"]
    - lint: dependsOn ["^build"]
    - typecheck: dependsOn ["^build"]
    - test: dependsOn ["^build"]
    - dev: cache false, persistent true

    Create tsconfig.base.json with strict TypeScript config (strict: true, noUncheckedIndexedAccess: true, target: ES2022, module: ESNext, moduleResolution: bundler, jsx: react-jsx).

    Create packages/config (@festapp/config) with shared TypeScript base config that extends tsconfig.base.json.

    Create packages/shared (@festapp/shared) with:
    - src/types/database.ts: Placeholder with TODO comment for Supabase-generated types. Export empty Database type interface.
    - src/validation/auth.ts: Zod schemas:
      - PhoneSchema: z.string().regex(/^\+[1-9]\d{6,14}$/, 'Phone must be in international format (+420...)')
      - EmailSchema: z.string().email()
      - OtpSchema: z.string().length(6).regex(/^\d+$/, 'Code must be 6 digits')
      - PasswordSchema: z.string().min(8, 'Password must be at least 8 characters')
      - DisplayNameSchema: z.string().min(1).max(50)
    - src/constants/auth.ts: OTP_LENGTH = 6, OTP_EXPIRY_SECONDS = 3600, SESSION_REFRESH_THRESHOLD_SECONDS = 300
    - src/index.ts: Barrel export of all validation schemas, types, and constants
    - package.json: name "@festapp/shared", main "src/index.ts" (no build step -- consumed via TypeScript paths). Dependencies: zod@^4.3, @supabase/supabase-js@^2.95.

    Create .gitignore with: node_modules, .next, .expo, dist, .turbo, *.tsbuildinfo, .env, .env.local, .env.*.local.
  </action>
  <verify>
    Run `pnpm install` at repo root -- must succeed without errors.
    Run `pnpm turbo typecheck --filter=@festapp/shared` -- must pass.
  </verify>
  <done>Root monorepo installs cleanly. Shared package compiles. Config package exports base TypeScript config.</done>
</task>

<task type="auto">
  <name>Task 2: Scaffold Next.js 16 web app and Expo SDK 54 mobile app with CI pipeline</name>
  <files>
    apps/web/package.json
    apps/web/next.config.ts
    apps/web/tsconfig.json
    apps/web/app/layout.tsx
    apps/web/app/page.tsx
    apps/web/app/globals.css
    apps/mobile/package.json
    apps/mobile/app.json
    apps/mobile/tsconfig.json
    apps/mobile/babel.config.js
    apps/mobile/metro.config.js
    apps/mobile/tailwind.config.js
    apps/mobile/nativewind-env.d.ts
    apps/mobile/global.css
    apps/mobile/app/_layout.tsx
    apps/mobile/app/index.tsx
    .github/workflows/ci.yml
  </files>
  <action>
    **Web app (apps/web):**
    Use `npx create-next-app@latest apps/web --typescript --tailwind --app --no-src-dir --no-import-alias` then adjust:
    - package.json: name "@festapp/web", add @festapp/shared as workspace:* dependency
    - tsconfig.json: extend @festapp/config, add path alias "@/*" -> "./*" and "@festapp/shared" -> "../../packages/shared/src"
    - next.config.ts: transpilePackages: ["@festapp/shared"]
    - app/layout.tsx: Minimal root layout with html, body, metadata (title "Festapp Rideshare")
    - app/page.tsx: Simple "Festapp Rideshare" heading that imports and uses a validation schema from @festapp/shared to prove the link works
    - Tailwind v4 (comes with create-next-app@latest)

    **Mobile app (apps/mobile):**
    Use `npx create-expo-app@latest apps/mobile --template blank-typescript` then adjust:
    - package.json: name "@festapp/mobile", add @festapp/shared as workspace:* dependency
    - Add dependencies per research: nativewind, react-native-reanimated, react-native-safe-area-context, expo-router, @expo/vector-icons
    - Add devDependencies: tailwindcss@3 (NOT v4 -- NativeWind v4.2 requires Tailwind v3)
    - tsconfig.json: extend @festapp/config, add path aliases
    - babel.config.js: Add 'nativewind/babel' preset
    - metro.config.js: withNativeWind wrapper for CSS handling
    - tailwind.config.js: Tailwind v3 config with content paths for app/ and components/, NativeWind preset
    - nativewind-env.d.ts: Triple-slash reference to nativewind types
    - global.css: @tailwind base; @tailwind components; @tailwind utilities;
    - app.json: Set scheme to "com.festapp.rideshare", set name "Festapp Rideshare", set slug "festapp-rideshare"
    - app/_layout.tsx: Minimal root layout with Slot from expo-router (auth gate comes in Plan 03)
    - app/index.tsx: Simple screen with "Festapp Rideshare" text that imports from @festapp/shared to prove the link works

    **CI pipeline (.github/workflows/ci.yml):**
    Create GitHub Actions workflow per research pattern (TEST-10):
    - Trigger: push to main, pull_request to main
    - Runner: ubuntu-latest
    - Steps: checkout (fetch-depth 0), setup pnpm v9, setup node 20 with pnpm cache, pnpm install --frozen-lockfile, pnpm turbo build lint typecheck test
    - Note: test will have no tests yet, which is fine (turbo skips empty tasks)
  </action>
  <verify>
    Run `pnpm turbo build` from root -- both apps must build without errors.
    Run `pnpm --filter @festapp/web dev` -- Next.js dev server starts on localhost:3000.
    Run `pnpm --filter @festapp/mobile start` -- Expo dev server starts without Metro bundler errors.
    Verify shared import: both apps' index pages reference @festapp/shared without import errors.
  </verify>
  <done>Both apps build and start their dev servers. Shared package imports work from both apps. CI workflow file exists and is valid YAML. Monorepo is ready for feature development.</done>
</task>

</tasks>

<verification>
- `pnpm install && pnpm turbo build` succeeds from clean checkout
- Web app renders at localhost:3000
- Mobile app starts Expo dev server
- `@festapp/shared` validation schemas are importable from both apps
- CI workflow is valid (check with `act` if available, or manual YAML validation)
- .npmrc contains node-linker=hoisted
- No Tailwind version conflict (v4 in web, v3 in mobile)
</verification>

<success_criteria>
Monorepo fully functional: install, build, dev servers work for both apps, shared package links verified, CI pipeline defined. Ready for Supabase setup in Plan 02.
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-auth/01-01-SUMMARY.md`
</output>
