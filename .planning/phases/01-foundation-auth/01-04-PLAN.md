---
phase: 01-foundation-auth
plan: 04
type: execute
wave: 4
depends_on: ["01-03"]
files_modified:
  - apps/mobile/app/(tabs)/_layout.tsx
  - apps/mobile/app/(tabs)/search/index.tsx
  - apps/mobile/app/(tabs)/my-rides/index.tsx
  - apps/mobile/app/(tabs)/messages/index.tsx
  - apps/mobile/app/(tabs)/profile/index.tsx
  - apps/mobile/app/settings.tsx
  - apps/web/app/(app)/layout.tsx
  - apps/web/app/(app)/search/page.tsx
  - apps/web/app/(app)/my-rides/page.tsx
  - apps/web/app/(app)/messages/page.tsx
  - apps/web/app/(app)/profile/page.tsx
  - apps/web/app/(app)/settings/page.tsx
  - packages/shared/src/constants/design.ts
  - apps/mobile/tailwind.config.js
  - apps/web/app/globals.css
autonomous: true
must_haves:
  truths:
    - "Bottom tab navigation shows Search, My Rides, Messages, Profile on mobile (NAV-01)"
    - "Sidebar or bottom navigation shows same tabs on web (NAV-01)"
    - "Search tab is the default landing screen after auth (NAV-02)"
    - "Each tab screen renders a placeholder with correct title (NAV-02 through NAV-05)"
    - "Settings screen is accessible from Profile tab (NAV-06)"
    - "Settings screen shows logout and delete account buttons that work (AUTH-04, AUTH-05)"
    - "Pastel color palette is applied to navigation and screens (PLAT-01)"
    - "Light and dark mode supported (PLAT-01)"
  artifacts:
    - path: "apps/mobile/app/(tabs)/_layout.tsx"
      provides: "Tab navigator with 4 tabs and pastel styling"
      contains: "Tabs"
    - path: "apps/web/app/(app)/layout.tsx"
      provides: "Authenticated app layout with navigation"
    - path: "packages/shared/src/constants/design.ts"
      provides: "Shared color palette and design tokens"
      contains: "colors"
    - path: "apps/mobile/app/settings.tsx"
      provides: "Settings screen with logout and delete account"
      contains: "deleteAccount"
    - path: "apps/web/app/(app)/settings/page.tsx"
      provides: "Web settings page with logout and delete account"
      contains: "deleteAccount"
  key_links:
    - from: "apps/mobile/app/(tabs)/_layout.tsx"
      to: "packages/shared/src/constants/design.ts"
      via: "import colors"
      pattern: "@festapp/shared.*design"
    - from: "apps/mobile/app/settings.tsx"
      to: "apps/mobile/lib/supabase.ts"
      via: "supabase.auth.signOut()"
      pattern: "signOut"
    - from: "apps/web/app/(app)/settings/page.tsx"
      to: "supabase/functions/delete-account"
      via: "fetch Edge Function"
      pattern: "delete-account"
---

<objective>
Build the app shell with bottom tab navigation (Search, My Rides, Messages, Profile), settings screen with logout/delete account, and pastel design system for both web and mobile.

Purpose: NAV-01 through NAV-06, AUTH-04, AUTH-05, and PLAT-01 establish the navigational structure and visual identity users interact with throughout the app.
Output: Fully navigable app shell with pastel design system, working logout, and account deletion.
</objective>

<execution_context>
@/Users/miakh/.claude/get-shit-done/workflows/execute-plan.md
@/Users/miakh/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-auth/01-RESEARCH.md
@.planning/phases/01-foundation-auth/01-02-SUMMARY.md
@.planning/phases/01-foundation-auth/01-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Define pastel design system and implement mobile tab navigation with settings</name>
  <files>
    packages/shared/src/constants/design.ts
    packages/shared/src/index.ts
    apps/mobile/tailwind.config.js
    apps/mobile/app/(tabs)/_layout.tsx
    apps/mobile/app/(tabs)/search/index.tsx
    apps/mobile/app/(tabs)/my-rides/index.tsx
    apps/mobile/app/(tabs)/messages/index.tsx
    apps/mobile/app/(tabs)/profile/index.tsx
    apps/mobile/app/settings.tsx
  </files>
  <action>
    **Design system (packages/shared/src/constants/design.ts):**
    Define a friendly pastel color palette for PLAT-01:
    ```
    Light mode:
    - background: #FAF7FF (soft lavender white)
    - surface: #FFFFFF
    - primary: #7C6FA0 (muted purple)
    - primaryLight: #B8ACE0 (light purple)
    - secondary: #6BA3A0 (soft teal)
    - accent: #E8A87C (warm peach)
    - text: #2D2B3D (dark purple-gray)
    - textSecondary: #8E8BA3 (muted purple-gray)
    - border: #E8E4F0 (light purple border)
    - success: #7BC67E (soft green)
    - warning: #F0C674 (soft yellow)
    - error: #E07070 (soft red)
    - tabBarActive: #7C6FA0
    - tabBarInactive: #B8B5C8

    Dark mode:
    - background: #1A1825 (dark purple)
    - surface: #252336 (dark surface)
    - primary: #B8ACE0 (light purple -- inverted from light mode)
    - primaryLight: #7C6FA0
    - secondary: #7BBFBC (brighter teal)
    - accent: #F0BC94 (brighter peach)
    - text: #EEEAF5 (light lavender)
    - textSecondary: #9E9BB3
    - border: #3D3A52
    - success: #8BD88E
    - warning: #F5D68A
    - error: #F08080
    - tabBarActive: #B8ACE0
    - tabBarInactive: #6E6B82
    ```
    Export as `colors` object with `light` and `dark` sub-objects.
    Export tab definitions: `tabs = [{ name: 'search', title: 'Search', icon: 'search' }, { name: 'my-rides', title: 'My Rides', icon: 'car' }, { name: 'messages', title: 'Messages', icon: 'comments' }, { name: 'profile', title: 'Profile', icon: 'user' }]`
    Update packages/shared/src/index.ts to export design constants.

    **Mobile Tailwind config (apps/mobile/tailwind.config.js):**
    Extend colors with the pastel palette from design.ts. Configure darkMode: 'class'. Add content paths for app/ and components/.

    **Mobile tab layout (apps/mobile/app/(tabs)/_layout.tsx):**
    Use expo-router Tabs component per research Pattern 6:
    - 4 tabs: Search, My Rides, Messages, Profile
    - FontAwesome icons: search, car, comments, user
    - Apply pastel colors from design tokens
    - Use useColorScheme() for light/dark mode detection
    - tabBarActiveTintColor and tabBarStyle from design tokens

    **Tab screens (placeholder content for Phase 1):**
    Each tab screen (search, my-rides, messages, profile):
    - SafeAreaView with pastel background
    - Screen title text centered
    - Placeholder content describing what will go here:
      - Search: "Search for rides" placeholder with search bar outline (NAV-02)
      - My Rides: "Your upcoming and past rides" placeholder (NAV-03)
      - Messages: "Your conversations" placeholder (NAV-04)
      - Profile: User info placeholder with "Settings" button that navigates to settings screen (NAV-05)
    - Apply NativeWind/Tailwind classes for pastel styling

    **Settings screen (apps/mobile/app/settings.tsx):**
    Full settings screen implementing NAV-06:
    - Section: Preferences -- Language (placeholder), Notification preferences (placeholder)
    - Section: Account -- "Log Out" button, "Delete Account" button (with confirmation alert)
    - Section: Info -- Help (placeholder), Legal (placeholder)
    - Log Out: Call supabase.auth.signOut(), auth gate in root layout handles redirect (AUTH-04)
    - Delete Account: Show Alert.alert confirmation dialog. On confirm, call the delete-account Edge Function via supabase.functions.invoke('delete-account'), then sign out (AUTH-05). Show error toast if deletion fails.
    - Style with pastel design tokens
  </action>
  <verify>
    Run `pnpm turbo typecheck` -- must pass.
    Run `pnpm turbo build --filter=@festapp/mobile` -- must compile.
    Verify tab layout has exactly 4 tabs with correct names and icons.
    Verify settings screen has working logout (calls signOut) and delete account (calls Edge Function).
    Verify dark mode colors switch based on useColorScheme.
  </verify>
  <done>Mobile app has 4-tab navigation with pastel design system, placeholder screens for each tab, and settings screen with working logout and delete account. Light and dark mode supported. NAV-01 through NAV-06, AUTH-04, AUTH-05, PLAT-01 implemented for mobile.</done>
</task>

<task type="auto">
  <name>Task 2: Implement web app shell with navigation and settings page</name>
  <files>
    apps/web/app/(app)/layout.tsx
    apps/web/app/(app)/search/page.tsx
    apps/web/app/(app)/my-rides/page.tsx
    apps/web/app/(app)/messages/page.tsx
    apps/web/app/(app)/profile/page.tsx
    apps/web/app/(app)/settings/page.tsx
    apps/web/app/globals.css
    apps/web/app/layout.tsx
  </files>
  <action>
    **Root layout update (apps/web/app/layout.tsx):**
    Add CSS variables for the pastel color palette (both light and dark mode) using Tailwind v4 @theme or CSS custom properties. Support prefers-color-scheme media query for automatic dark mode. Import globals.css.

    **Globals CSS (apps/web/app/globals.css):**
    Define CSS custom properties for the pastel palette (light and dark using @media prefers-color-scheme). Use Tailwind v4 @import "tailwindcss". Define base styles: body background, text color using CSS vars.

    **Authenticated layout (apps/web/app/(app)/layout.tsx):**
    - Server component that checks auth via server Supabase client
    - If no session, redirect to /login
    - Bottom navigation bar on mobile viewport / sidebar on desktop:
      - Search, My Rides, Messages, Profile links
      - Use same icons as mobile (can use Heroicons or SVG equivalents for web)
      - Active tab highlighted with primary color
      - Pastel styling matching mobile design
    - Main content area with appropriate max-width and padding
    - Use the design tokens from @festapp/shared for color consistency

    **Page screens (placeholder content):**
    Each page (search, my-rides, messages, profile):
    - Same placeholder content as mobile equivalents
    - Profile page includes link to /settings
    - Apply Tailwind v4 classes with pastel design system
    - Responsive: looks good on mobile browser and desktop

    **Settings page (apps/web/app/(app)/settings/page.tsx):**
    Same structure as mobile settings but web-styled:
    - Sections: Preferences, Account, Info
    - Log Out: Call supabase.auth.signOut() via browser client, redirect to /login (AUTH-04)
    - Delete Account: Show browser confirm() dialog. On confirm, call delete-account Edge Function. Sign out and redirect to /login (AUTH-05).
    - Note: Use 'use client' directive for interactive components. Server component for layout.
    - Pastel card-based layout for settings sections
  </action>
  <verify>
    Run `pnpm turbo build --filter=@festapp/web` -- must compile.
    Verify (app) layout checks auth and redirects.
    Verify navigation shows 4 tabs/links with correct labels.
    Verify settings page has logout and delete account functionality.
    Verify dark mode works via prefers-color-scheme.
    Verify responsive: bottom nav on mobile, sidebar on desktop.
  </verify>
  <done>Web app has authenticated layout with responsive navigation (bottom tabs on mobile viewport, sidebar on desktop), placeholder pages for all 4 main sections, and settings page with working logout and delete account. Pastel design system applied with light/dark mode support. Full parity with mobile navigation structure.</done>
</task>

</tasks>

<verification>
- Mobile: 4 bottom tabs render with correct icons and labels
- Mobile: Tapping tabs navigates to correct screens
- Mobile: Settings accessible from profile, logout and delete work
- Web: Authenticated layout redirects to login if no session
- Web: Navigation shows 4 sections, settings page works
- Both: Pastel color palette applied consistently
- Both: Dark mode supported (useColorScheme on mobile, prefers-color-scheme on web)
- NAV-01 through NAV-06 covered
- AUTH-04 (logout) and AUTH-05 (delete account) functional
- PLAT-01 (pastel design, light/dark) applied
</verification>

<success_criteria>
Complete navigable app shell on both platforms with pastel design system. Users can navigate all main sections, access settings, log out, and delete their account. Design is consistent between web and mobile. Ready for onboarding flow in Plan 05.
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-auth/01-04-SUMMARY.md`
</output>
