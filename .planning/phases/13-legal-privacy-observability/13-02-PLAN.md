---
phase: 13-legal-privacy-observability
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/app/(auth)/signup/page.tsx
  - apps/mobile/app/(auth)/signup.tsx
  - apps/web/app/(public)/terms/page.tsx
  - apps/web/app/(public)/privacy/page.tsx
  - apps/web/lib/i18n/translations/cs.ts
  - apps/web/lib/i18n/translations/sk.ts
  - apps/web/lib/i18n/translations/en.ts
autonomous: true
requirements:
  - LEGAL-01
  - LEGAL-02

must_haves:
  truths:
    - "User must check a Terms of Service and Privacy Policy checkbox before completing email signup on web"
    - "User must check a Terms of Service and Privacy Policy checkbox before completing phone signup on web"
    - "User must check a Terms of Service and Privacy Policy checkbox before completing email signup on mobile"
    - "Social OAuth buttons (Google, Apple) are gated by the same ToS checkbox on web"
    - "The accepted_terms_at ISO timestamp is stored in user_metadata for all signup methods"
    - "Terms of Service page has production-quality Czech legal text"
    - "Privacy Policy page has production-quality Czech legal text"
  artifacts:
    - path: "apps/web/app/(auth)/signup/page.tsx"
      provides: "ToS checkbox in email form, phone form, and social auth gate"
      contains: "accepted_terms"
    - path: "apps/mobile/app/(auth)/signup.tsx"
      provides: "ToS checkbox in mobile email signup form"
      contains: "accepted_terms"
    - path: "apps/web/app/(public)/terms/page.tsx"
      provides: "Czech and English Terms of Service"
      contains: "Obchodní podmínky"
    - path: "apps/web/app/(public)/privacy/page.tsx"
      provides: "Czech and English Privacy Policy"
      contains: "Zásady ochrany osobních údajů"
  key_links:
    - from: "apps/web/app/(auth)/signup/page.tsx"
      to: "supabase.auth.signUp()"
      via: "accepted_terms_at in options.data"
      pattern: "accepted_terms_at.*toISOString"
    - from: "apps/web/app/(auth)/signup/page.tsx"
      to: "supabase.auth.signInWithOtp()"
      via: "accepted_terms_at in options.data"
      pattern: "accepted_terms_at.*toISOString"
    - from: "apps/mobile/app/(auth)/signup.tsx"
      to: "supabase.auth.signUp()"
      via: "accepted_terms_at in options.data"
      pattern: "accepted_terms_at.*toISOString"
---

<objective>
Add Terms of Service consent checkbox to all signup flows and generate production-quality Czech legal content.

Purpose: Meet legal requirements for user consent by ensuring every new user explicitly accepts the Terms of Service and Privacy Policy before completing signup, with the acceptance timestamp stored for audit compliance.

Output:
- ToS checkbox on web signup (email, phone, and social auth flows)
- ToS checkbox on mobile signup (email flow)
- Czech legal text for Terms of Service and Privacy Policy pages
- accepted_terms_at timestamp in user_metadata for all signup methods
</objective>

<execution_context>
@/Users/miakh/.claude/get-shit-done/workflows/execute-plan.md
@/Users/miakh/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-legal-privacy-observability/13-RESEARCH.md
@apps/web/app/(auth)/signup/page.tsx
@apps/mobile/app/(auth)/signup.tsx
@apps/web/app/(public)/terms/page.tsx
@apps/web/app/(public)/privacy/page.tsx
@apps/web/lib/i18n/translations/cs.ts
@apps/web/lib/i18n/translations/en.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add ToS checkbox to web and mobile signup forms</name>
  <files>apps/web/app/(auth)/signup/page.tsx, apps/mobile/app/(auth)/signup.tsx, apps/web/lib/i18n/translations/cs.ts, apps/web/lib/i18n/translations/sk.ts, apps/web/lib/i18n/translations/en.ts</files>
  <action>
**Web signup (apps/web/app/(auth)/signup/page.tsx):**

1. Add `accepted_terms` to **both** Zod schemas:
   - `EmailSignUpSchema`: add `accepted_terms: z.literal(true, { errorMap: () => ({ message: t("auth.mustAcceptTerms") }) })`. Since Zod schemas are defined outside the component and can't use `t()`, use a static error message string and override with i18n in the form error display, OR define schemas inside the component. Simplest approach: use `z.literal(true, { errorMap: () => ({ message: "required" }) })` and display the i18n error in the form.
   - `PhoneSignUpSchema`: add the same `accepted_terms: z.literal(true, ...)` field.

2. Add a **shared state** `acceptedTerms` (boolean) at the top of the component that is checked by ALL signup methods. Alternatively, add the checkbox to both forms individually. The research recommends a single checkbox above the social buttons that gates ALL methods. **Recommended approach**: Add a single `acceptedTerms` state variable. Show the checkbox above the tab switcher. Validate it before any signup action (email, phone, social).

   Actually, the cleanest approach per research: Add the `accepted_terms` field to both email and phone Zod schemas (form validation will enforce it). For social auth, add a separate state check.

   **Simpler unified approach:**
   - Add a single `const [acceptedTerms, setAcceptedTerms] = useState(false)` state
   - Render the checkbox ONCE, above the tab switcher, visible for all flows
   - In `onEmailSubmit`: check `acceptedTerms` and set error if false, then pass `accepted_terms_at: new Date().toISOString()` in `options.data`
   - In `onPhoneSubmit`: check `acceptedTerms` and set error if false, then pass `accepted_terms_at: new Date().toISOString()` in `options.data`
   - In `signInWithGoogle` and `signInWithApple`: check `acceptedTerms` and set error if false. Note: OAuth signInWithOAuth doesn't support `options.data` for metadata, so for social auth users the `accepted_terms_at` must be set differently. **The simplest approach: require checkbox checked before allowing any social button click. Display "You must accept the Terms of Service" error if not checked.** For social OAuth, the metadata can be set post-auth via `supabase.auth.updateUser({ data: { accepted_terms_at: ... } })` in the auth callback, OR accept that social users' acceptance is implicit (checked the box = consent). Since the checkbox is checked before OAuth redirect, the consent is proven by the flow -- store the timestamp after OAuth callback. For MVP: just gate the button (require checkbox before allowing click). The checkbox presence + click proves consent.

   **Final implementation:**
   - Add `acceptedTerms` state, render checkbox once above tab switcher
   - Gate all 4 submit functions with `if (!acceptedTerms) { setError(t("auth.mustAcceptTerms")); return; }` at the top
   - For email signUp: add `accepted_terms_at: new Date().toISOString()` to `options.data`
   - For phone signInWithOtp: add `accepted_terms_at: new Date().toISOString()` to `options.data`
   - Social auth: gate with checkbox check (metadata stored by the auth callback separately if needed, but consent is proven by UI flow)

3. Checkbox UI -- render ABOVE the tab switcher, after the heading and error display:
```tsx
<label className="mb-4 flex items-start gap-2">
  <input
    type="checkbox"
    checked={acceptedTerms}
    onChange={(e) => setAcceptedTerms(e.target.checked)}
    className="mt-1 h-4 w-4 rounded border-border text-primary focus:ring-primary"
  />
  <span className="text-xs text-text-secondary">
    {t("auth.agreeToTermsPre")}{" "}
    <Link href="/terms" target="_blank" className="text-primary hover:underline">
      {t("auth.termsOfService")}
    </Link>{" "}
    {t("common.and")}{" "}
    <Link href="/privacy" target="_blank" className="text-primary hover:underline">
      {t("auth.privacyPolicy")}
    </Link>
  </span>
</label>
```

**Mobile signup (apps/mobile/app/(auth)/signup.tsx):**

1. Add `accepted_terms` to the `SignUpFormSchema`: `accepted_terms: z.literal(true, { errorMap: () => ({ message: "You must accept the Terms of Service" }) })`
2. Add a checkbox UI using a `TouchableOpacity` with a checkmark icon:
```tsx
<Controller
  control={control}
  name="accepted_terms"
  render={({ field: { onChange, value } }) => (
    <TouchableOpacity
      onPress={() => onChange(!value)}
      style={{ flexDirection: "row", alignItems: "flex-start", gap: 8, marginBottom: 16 }}
    >
      <View style={{
        width: 20, height: 20, borderWidth: 1.5, borderRadius: 4,
        borderColor: value ? "#A8D5BA" : "#ccc",
        backgroundColor: value ? "#A8D5BA" : "transparent",
        justifyContent: "center", alignItems: "center",
      }}>
        {value && <Text style={{ color: "white", fontSize: 14, fontWeight: "bold" }}>✓</Text>}
      </View>
      <Text style={{ fontSize: 12, color: "#666", flex: 1 }}>
        I agree to the Terms of Service and Privacy Policy
      </Text>
    </TouchableOpacity>
  )}
/>
```
3. Add `accepted_terms_at: new Date().toISOString()` to the `options.data` in the `supabase.auth.signUp()` call.

**i18n translations** -- Add these keys to all three translation files (cs.ts, sk.ts, en.ts):
- `auth.agreeToTermsPre`: "I agree to the" / "Souhlasim s" / "Suhlasim s"
- `auth.termsOfService`: "Terms of Service" / "Obchodnimi podminkami" / "Obchodnymi podmienkami"
- `auth.privacyPolicy`: "Privacy Policy" / "Zasadami ochrany osobnich udaju" / "Zasadami ochrany osobnych udajov"
- `auth.mustAcceptTerms`: "You must accept the Terms of Service and Privacy Policy" / "Musite souhlasit s obchodnimi podminkami a zasadami ochrany osobnich udaju" / "Musite suhlasit s obchodnymi podmienkami"

Use proper Czech/Slovak diacritics in the actual translations. The above are ASCII approximations.
  </action>
  <verify>
1. Read `apps/web/app/(auth)/signup/page.tsx` and confirm:
   - `acceptedTerms` state exists
   - Checkbox is rendered with ToS/Privacy links
   - All 4 submit functions check `acceptedTerms` before proceeding
   - `accepted_terms_at` is passed in signUp and signInWithOtp options.data
2. Read `apps/mobile/app/(auth)/signup.tsx` and confirm:
   - `accepted_terms` field in Zod schema
   - Checkbox Controller rendered
   - `accepted_terms_at` in signUp options.data
3. Translation files have the new auth.* keys
  </verify>
  <done>
- Web signup requires ToS checkbox for email, phone, AND social auth
- Mobile signup requires ToS checkbox for email signup
- accepted_terms_at timestamp stored in user_metadata for email and phone signups
- Social auth gated by checkbox (consent proven by UI flow)
- i18n translations for ToS consent text in cs, sk, en
  </done>
</task>

<task type="auto">
  <name>Task 2: Generate Czech legal content for Terms and Privacy pages</name>
  <files>apps/web/app/(public)/terms/page.tsx, apps/web/app/(public)/privacy/page.tsx</files>
  <action>
Per locked user decision: Generate **real, production-quality Czech legal text** (not placeholder Lorem ipsum).

**Terms of Service page (apps/web/app/(public)/terms/page.tsx):**

Replace the current English-only content with a bilingual page. Structure:
1. Czech section first (primary audience), then English section below
2. Use proper Czech legal terminology following Czech Civil Code (Obcansky zakonik) conventions

Czech ToS content must cover these sections:
- **Uvodni ustanoveni**: Platform description, operator identity (community project), acceptance by use
- **Definice pojmu**: Definitions (ridic = driver, spolucestujici = passenger, jizda = ride)
- **Registrace a ucet**: Account requirements (18+, valid license for drivers, truthful info)
- **Pravidla pouzivani**: Usage rules (no commercial transport, driver liability for vehicle, no illegal goods)
- **Sdileni nakladu**: Cost sharing rules (driver sets contribution, not commercial fare, fuel/toll sharing only)
- **Hodnoceni a recenze**: Ratings/reviews must be honest, no defamatory content
- **Ochrana soukromi**: Reference to Privacy Policy, location sharing consent
- **Omezeni odpovednosti**: Platform is intermediary only, no guarantee of ride availability/safety, users responsible for insurance
- **Zmeny podminek**: Platform may update ToS, continued use = acceptance
- **Rozhodne pravo**: Czech law applies, disputes resolved by Czech courts
- **Kontakt**: contact@spolujizda.online

Keep the existing English content but update it to match the Czech sections. Use the existing page structure with `<article className="prose prose-lg ...">`.

**Privacy Policy page (apps/web/app/(public)/privacy/page.tsx):**

Same bilingual approach. Czech Privacy Policy covering:
- **Jake udaje shromazdujeme**: Name, email/phone, profile photo, vehicle info, location (when shared), usage data
- **Jak udaje pouzivame**: Matchmaking, notifications, safety (ratings/reviews), analytics
- **Pravni zaklad zpracovani**: Consent (Art. 6(1)(a) GDPR), contract performance (Art. 6(1)(b)), legitimate interest (Art. 6(1)(f))
- **Sdileni udaju**: With other users (profile, ratings), with service providers (AWS SES/SNS, OneSignal), no sale to third parties
- **Uchovavani udaju**: Active account = stored; deleted account = 30 days grace then purge; audit logs = 1 year
- **Vase prava**: Access, rectification, deletion (GDPR Art. 15-22), data export from settings
- **Soubory cookie**: Functional cookies only, no advertising cookies
- **Zmeny zasad**: Updates communicated via email/notification
- **Kontakt**: contact@spolujizda.online, DPO not required (small community project)

Both pages should keep `Last updated: February 2026` / `Poslední aktualizace: únor 2026`.

IMPORTANT: Use proper Czech diacritics (háčky, čárky) throughout. This is production text, not transliteration.
  </action>
  <verify>
1. Read both pages and confirm Czech content exists with proper diacritics
2. Both pages have bilingual content (Czech first, English second)
3. ToS covers: eligibility, usage rules, cost sharing, liability limitation, governing law
4. Privacy covers: data collected, legal basis, retention, user rights, contact
5. Both pages reference the correct domain (spolujizda.online)
  </verify>
  <done>
- Terms of Service page has production-quality Czech legal text covering all required sections
- Privacy Policy page has production-quality Czech legal text with GDPR references
- Both pages are bilingual (Czech primary, English secondary)
- Content is suitable for a free community carpooling platform under Czech law
  </done>
</task>

</tasks>

<verification>
1. Web signup form shows ToS checkbox and blocks all signup methods until checked
2. Mobile signup form shows ToS checkbox and blocks signup until checked
3. `accepted_terms_at` timestamp appears in signUp/signInWithOtp options.data
4. Terms page has Czech legal content with proper diacritics
5. Privacy page has Czech legal content with GDPR references
6. i18n translations exist for ToS consent strings
</verification>

<success_criteria>
- No user can complete any signup flow without checking the ToS checkbox
- accepted_terms_at ISO timestamp is stored in user_metadata for email and phone signups
- Terms of Service and Privacy Policy pages contain production-quality Czech legal text
- LEGAL-01 and LEGAL-02 requirements are fully satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/13-legal-privacy-observability/13-02-SUMMARY.md`
</output>
