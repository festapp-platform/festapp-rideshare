---
phase: 11-polish-testing-launch
plan: 04
type: execute
wave: 2
depends_on: ["11-01", "11-02"]
files_modified:
  - apps/web/components/accessible-button.tsx
  - apps/web/components/skip-link.tsx
  - apps/web/app/(app)/app-nav.tsx
  - apps/web/app/(app)/layout.tsx
  - apps/web/app/globals.css
  - apps/web/__tests__/accessibility.test.tsx
autonomous: true

must_haves:
  truths:
    - "All interactive elements have ARIA labels for screen readers"
    - "Skip-to-content link allows keyboard users to bypass navigation"
    - "Focus indicators are visible on all interactive elements"
    - "Touch targets are at least 44x44 pixels on mobile"
    - "Color contrast ratios meet WCAG AA standards"
  artifacts:
    - path: "apps/web/components/accessible-button.tsx"
      provides: "Accessible button component with proper ARIA and touch targets"
      contains: "AccessibleButton"
    - path: "apps/web/components/skip-link.tsx"
      provides: "Skip-to-content keyboard navigation link"
      contains: "SkipLink"
    - path: "apps/web/__tests__/accessibility.test.tsx"
      provides: "Accessibility tests"
  key_links:
    - from: "apps/web/app/(app)/layout.tsx"
      to: "apps/web/components/skip-link.tsx"
      via: "SkipLink rendered at top of layout"
      pattern: "SkipLink"
    - from: "apps/web/app/globals.css"
      to: "apps/web/components/accessible-button.tsx"
      via: "Focus ring CSS utility classes"
      pattern: "focus-visible"
---

<objective>
Accessibility audit and polish — screen reader labels, color contrast, touch targets, keyboard navigation.

Purpose: PLAT-15 requires basic accessibility compliance. This plan adds ARIA attributes, skip navigation, focus indicators, and touch target sizing across the app. It also audits color contrast and fixes any issues in the CSS custom properties.

Output: Accessible button component, skip-to-content link, CSS focus utilities, ARIA improvements on navigation, accessibility tests.
</objective>

<execution_context>
@/Users/miakh/.claude/get-shit-done/workflows/execute-plan.md
@/Users/miakh/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@apps/web/app/(app)/app-nav.tsx
@apps/web/app/(app)/layout.tsx
@apps/web/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Accessibility infrastructure — skip link, focus styles, ARIA on navigation, touch targets</name>
  <files>
    apps/web/components/accessible-button.tsx
    apps/web/components/skip-link.tsx
    apps/web/app/(app)/app-nav.tsx
    apps/web/app/(app)/layout.tsx
    apps/web/app/globals.css
  </files>
  <action>
1. Create `apps/web/components/skip-link.tsx`:
   - "use client" directive
   - Renders an anchor link: "Skip to main content"
   - Visually hidden by default (sr-only), becomes visible on focus (not-sr-only on focus)
   - href="#main-content" — links to the main content area
   - Styled: bg-primary text-white px-4 py-2 rounded-lg, positioned fixed top-2 left-2, z-50
   - Uses Tailwind: `sr-only focus:not-sr-only focus:fixed focus:top-2 focus:left-2 focus:z-50 focus:bg-primary focus:text-white focus:px-4 focus:py-2 focus:rounded-lg`

2. Create `apps/web/components/accessible-button.tsx`:
   - A wrapper around `<button>` that enforces accessibility best practices:
     - Requires `aria-label` OR visible text content (TypeScript enforced via props)
     - Minimum touch target: min-h-[44px] min-w-[44px] (WCAG 2.5.8)
     - Focus ring: `focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2`
     - Disabled state: `disabled:opacity-50 disabled:cursor-not-allowed`
   - Props extend ButtonHTMLAttributes<HTMLButtonElement> + optional `size?: 'sm' | 'md' | 'lg'`
   - Forwarded ref for composability
   - This is a utility component — existing buttons don't need to migrate immediately, but new features should use it

3. Update `apps/web/app/(app)/app-nav.tsx`:
   - Add `aria-label` to all navigation links (e.g., aria-label="Search rides", aria-label="My rides", etc.)
   - Add `role="navigation"` and `aria-label="Main navigation"` to the nav container
   - Add `aria-current="page"` to the active tab link
   - Ensure all tab icons have aria-hidden="true" (decorative when text label is present)
   - Ensure tab links have min-h-[44px] touch target

4. Update `apps/web/app/(app)/layout.tsx`:
   - Import SkipLink
   - Add `<SkipLink />` as the very first element in the layout (before any nav)
   - Add `id="main-content"` to the main content container element
   - Add `<main>` semantic tag wrapping the content area if not already present
   - Ensure the layout has proper landmark structure: nav, main, aside (if applicable)

5. Update `apps/web/app/globals.css`:
   - Add global focus-visible styles for interactive elements:
     ```css
     :focus-visible {
       outline: 2px solid var(--primary);
       outline-offset: 2px;
       border-radius: 4px;
     }
     ```
   - Verify color contrast ratios for existing CSS vars:
     - --text (#2D2B3D) on --background (#FAF7FF): should be 10.5:1 (passes AA)
     - --text-secondary (#8E8BA3) on --background: check ratio and if below 4.5:1, darken it
     - --primary (#7C6FA0) on white: check and if below 4.5:1 for text, note it (may be used only for large text or non-text)
     - If any contrast issues found, adjust the lighter color to meet 4.5:1 minimum
   - Add reduced-motion media query for animations:
     ```css
     @media (prefers-reduced-motion: reduce) {
       *, *::before, *::after {
         animation-duration: 0.01ms !important;
         animation-iteration-count: 1 !important;
         transition-duration: 0.01ms !important;
       }
     }
     ```
  </action>
  <verify>
   - `pnpm --filter web typecheck` passes
   - Skip link visible on Tab key press
   - Navigation has proper ARIA labels
   - Focus indicators visible on tab navigation
  </verify>
  <done>
   - SkipLink allows keyboard users to jump to main content
   - All nav items have ARIA labels and proper landmark roles
   - Focus-visible styles applied globally
   - Touch targets meet 44px minimum
   - Reduced motion preference respected
  </done>
</task>

<task type="auto">
  <name>Task 2: Accessibility unit tests</name>
  <files>
    apps/web/__tests__/accessibility.test.tsx
  </files>
  <action>
1. Create `apps/web/__tests__/accessibility.test.tsx`:
   - Test SkipLink: renders with "Skip to main content" text, has href="#main-content", has sr-only class by default
   - Test AccessibleButton: renders with aria-label, has minimum height/width classes, shows focus ring classes, forwards ref correctly
   - Test AccessibleButton disabled: has disabled attribute and opacity class
   - Test navigation ARIA: verify app-nav has role="navigation", links have aria-label, active link has aria-current
   - Test color contrast (programmatic):
     - Helper function to calculate relative luminance from hex
     - Helper function to calculate contrast ratio between two colors
     - Test that --text on --background meets 4.5:1 (AA normal text)
     - Test that --text-secondary on --background meets 4.5:1 (or 3:1 for large text)
     - Test that dark mode --text on dark --background also meets 4.5:1
   - Test reduced motion: verify the CSS contains prefers-reduced-motion rule (read globals.css as string and check for the media query)
   - At least 10 test cases
   - Use inline JSX pattern for component rendering (consistent with existing test pattern for pnpm dual-React)
  </action>
  <verify>
   - `cd apps/web && npx vitest run __tests__/accessibility.test.tsx` — all tests pass
  </verify>
  <done>
   - 10+ accessibility tests pass validating ARIA labels, focus styles, color contrast, reduced motion
   - Color contrast ratios verified programmatically for both light and dark themes
  </done>
</task>

</tasks>

<verification>
- Tab key navigates through all interactive elements with visible focus indicators
- Skip link appears on first Tab press and jumps to main content
- Screen reader can identify all navigation items
- Color contrast meets WCAG AA standards (4.5:1 for normal text)
- Touch targets are minimum 44x44px on mobile
- Tests pass: `cd apps/web && npx vitest run __tests__/accessibility.test.tsx`
</verification>

<success_criteria>
- PLAT-15 satisfied: Screen reader labels, color contrast, touch targets, focus indicators
- Skip-to-content navigation works for keyboard users
- Reduced motion preference is respected
- 10+ accessibility tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/11-polish-testing-launch/11-04-SUMMARY.md`
</output>
