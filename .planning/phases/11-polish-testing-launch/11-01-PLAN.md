---
phase: 11-polish-testing-launch
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/shared/src/constants/i18n.ts
  - packages/shared/src/index.ts
  - apps/web/lib/i18n/translations.ts
  - apps/web/lib/i18n/provider.tsx
  - apps/web/lib/i18n/use-translations.ts
  - apps/web/app/layout.tsx
  - apps/web/app/(app)/settings/page.tsx
  - apps/web/app/(app)/settings/language/page.tsx
  - apps/web/__tests__/i18n.test.ts
autonomous: true

must_haves:
  truths:
    - "User can switch between Czech, Slovak, and English from settings"
    - "UI labels and strings render in the selected language"
    - "Language preference persists across page refreshes via localStorage"
    - "Default language is Czech (cs) for new users"
  artifacts:
    - path: "packages/shared/src/constants/i18n.ts"
      provides: "Supported locales enum and locale type"
      contains: "SUPPORTED_LOCALES"
    - path: "apps/web/lib/i18n/translations.ts"
      provides: "Translation dictionaries for cs, sk, en"
      contains: "translations"
    - path: "apps/web/lib/i18n/provider.tsx"
      provides: "React context provider for i18n"
      contains: "I18nProvider"
    - path: "apps/web/lib/i18n/use-translations.ts"
      provides: "useTranslations hook for consuming translations"
      contains: "useTranslations"
    - path: "apps/web/app/(app)/settings/language/page.tsx"
      provides: "Language selection page in settings"
    - path: "apps/web/__tests__/i18n.test.ts"
      provides: "Tests for i18n system"
  key_links:
    - from: "apps/web/app/layout.tsx"
      to: "apps/web/lib/i18n/provider.tsx"
      via: "I18nProvider wraps children"
      pattern: "I18nProvider"
    - from: "apps/web/app/(app)/settings/page.tsx"
      to: "apps/web/app/(app)/settings/language/page.tsx"
      via: "Router push to /settings/language"
      pattern: "router.push.*settings/language"
---

<objective>
Add internationalization support for Czech, Slovak, and English languages.

Purpose: PLAT-02 requires the app to support three languages. This plan implements a lightweight client-side i18n system using React context and a translation dictionary — no heavy i18n framework needed since the app has a finite set of UI strings.

Output: I18nProvider, useTranslations hook, translation dictionaries for cs/sk/en, language settings page, unit tests.
</objective>

<execution_context>
@/Users/miakh/.claude/get-shit-done/workflows/execute-plan.md
@/Users/miakh/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@apps/web/app/layout.tsx
@apps/web/app/(app)/settings/page.tsx
@packages/shared/src/index.ts
@packages/shared/src/constants/design.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: I18n infrastructure — shared constants, translations, provider, and hook</name>
  <files>
    packages/shared/src/constants/i18n.ts
    packages/shared/src/index.ts
    apps/web/lib/i18n/translations.ts
    apps/web/lib/i18n/provider.tsx
    apps/web/lib/i18n/use-translations.ts
    apps/web/app/layout.tsx
  </files>
  <action>
1. Create `packages/shared/src/constants/i18n.ts`:
   - Export `SUPPORTED_LOCALES` as `const` array: `['cs', 'sk', 'en']`
   - Export type `SupportedLocale = 'cs' | 'sk' | 'en'`
   - Export `DEFAULT_LOCALE = 'cs' as const`
   - Export `LOCALE_NAMES: Record<SupportedLocale, string>` = { cs: 'Cestina', sk: 'Slovencina', en: 'English' }
   - Export `LOCALE_STORAGE_KEY = 'festapp-locale'`

2. Export from `packages/shared/src/index.ts`:
   - Add exports for SUPPORTED_LOCALES, DEFAULT_LOCALE, LOCALE_NAMES, LOCALE_STORAGE_KEY, SupportedLocale

3. Create `apps/web/lib/i18n/translations.ts`:
   - Define a `TranslationKeys` type with string keys organized by feature area (flat dot notation is fine)
   - Create translation objects for cs, sk, en covering these categories:
     - **nav**: search, myRides, messages, profile, settings (tab labels)
     - **auth**: login, signup, logout, deleteAccount, forgotPassword
     - **settings**: language, notifications, blockedUsers, help, legal, preferences, privacy, account, info
     - **rides**: postRide, searchRides, departure, destination, date, seats, price, bookSeat, cancel, complete
     - **booking**: instantBook, requestSeat, pending, confirmed, cancelled, reject, accept
     - **chat**: typeMessage, sendMessage, contactShared, noMessages
     - **profile**: editProfile, vehicles, addVehicle, bio, socialLinks, verificationBadge
     - **common**: loading, error, save, cancel, delete, confirm, noResults, retry, back, close, share
     - **empty**: noRides, noMessages, noBookings, noReviews, noEvents
     - **errors**: networkError, notFound, serverError, unauthorized, rateLimited
   - Export `translations: Record<SupportedLocale, TranslationKeys>`
   - Czech (cs) is the primary language — all strings must be correct Czech
   - Slovak (sk) should be correct Slovak (NOT just Czech with minor changes)
   - English (en) should be natural English

4. Create `apps/web/lib/i18n/provider.tsx`:
   - "use client" directive
   - Create `I18nContext` with React.createContext
   - `I18nProvider` component that:
     - Reads initial locale from localStorage (LOCALE_STORAGE_KEY) on mount, falls back to DEFAULT_LOCALE
     - Provides `{ locale, setLocale, t }` via context
     - `t(key: string)` function looks up key in translations[locale], returns key itself if not found (graceful fallback)
     - When `setLocale` called, updates localStorage and state
   - Export `useI18n` hook that consumes the context

5. Create `apps/web/lib/i18n/use-translations.ts`:
   - Re-export `useI18n` from provider as `useTranslations` for convenience
   - This is just an alias file for cleaner imports

6. Update `apps/web/app/layout.tsx`:
   - Import I18nProvider from '@/lib/i18n/provider'
   - Wrap `{children}` inside `<I18nProvider>` (inside body, wrapping existing content)
   - Keep PwaInstallPrompt outside I18nProvider (it doesn't need translations)
  </action>
  <verify>
   - `pnpm --filter @festapp/shared build` (or typecheck) passes
   - `pnpm --filter web typecheck` passes (if available) or no TS errors on manual check
   - I18nProvider renders without errors
  </verify>
  <done>
   - Translation dictionaries exist for cs, sk, en with 50+ keys each
   - I18nProvider wraps the app and provides locale/t function via context
   - useTranslations hook is available for components to consume
  </done>
</task>

<task type="auto">
  <name>Task 2: Language settings page, settings integration, and unit tests</name>
  <files>
    apps/web/app/(app)/settings/language/page.tsx
    apps/web/app/(app)/settings/page.tsx
    apps/web/__tests__/i18n.test.ts
  </files>
  <action>
1. Create `apps/web/app/(app)/settings/language/page.tsx`:
   - "use client" directive
   - Import useI18n from provider, SUPPORTED_LOCALES, LOCALE_NAMES from @festapp/shared
   - Show a list of language options (Czech, Slovak, English) with radio-button or check style
   - Current locale shows a checkmark indicator
   - Clicking a language calls setLocale(newLocale) and shows a toast via sonner ("Language changed")
   - Use existing card style (rounded-xl, border-border-pastel, bg-surface) matching settings page pattern
   - Back link to /settings at top

2. Update `apps/web/app/(app)/settings/page.tsx`:
   - Change the Language item onClick from alert() to `router.push("/settings/language")`
   - Change the Help & Support item onClick from alert() to `router.push("/help")` (placeholder for plan 05)
   - Change the Legal item onClick from alert() to `router.push("/legal")` (placeholder for plan 05)
   - Use useTranslations hook to translate section titles and item labels (settings.language, settings.notifications, etc.)
   - Keep the SettingsSection component pattern but pass translated strings

3. Create `apps/web/__tests__/i18n.test.ts`:
   - Test translations object: all three locales have same keys (no missing translations)
   - Test t() function: returns correct string for known key, returns key for unknown key
   - Test locale switching: setLocale changes active translations
   - Test default locale is 'cs'
   - Test SUPPORTED_LOCALES contains exactly ['cs', 'sk', 'en']
   - Test LOCALE_NAMES has entries for all supported locales
   - Use vitest with happy-dom environment
   - At least 8 test cases
  </action>
  <verify>
   - `cd apps/web && npx vitest run __tests__/i18n.test.ts` — all tests pass
   - Language settings page renders language options
   - Settings page links to language settings
  </verify>
  <done>
   - Language settings page at /settings/language allows switching between cs, sk, en
   - Settings page items are translated based on current locale
   - Test suite validates translation completeness and i18n functionality with 8+ tests
  </done>
</task>

</tasks>

<verification>
- All three language dictionaries contain identical key sets
- Switching language updates all visible UI text on settings page
- Language preference persists in localStorage and survives page refresh
- Tests pass: `cd apps/web && npx vitest run __tests__/i18n.test.ts`
</verification>

<success_criteria>
- PLAT-02 satisfied: Czech, Slovak, and English supported
- Language switching works from settings with immediate UI update
- 8+ unit tests pass covering translation completeness and i18n mechanics
</success_criteria>

<output>
After completion, create `.planning/phases/11-polish-testing-launch/11-01-SUMMARY.md`
</output>
