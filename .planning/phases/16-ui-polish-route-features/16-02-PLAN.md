---
phase: 16-ui-polish-route-features
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/app/(app)/my-rides/page.tsx
  - apps/web/app/(app)/settings/notifications/page.tsx
  - packages/shared/src/i18n/translations/cs.ts
  - packages/shared/src/i18n/translations/sk.ts
  - packages/shared/src/i18n/translations/en.ts
autonomous: true
requirements:
  - UX-05
  - UX-06

must_haves:
  truths:
    - "My Rides page shows a single chronological list per top tab (upcoming first ascending, past descending) without sub-tab switcher"
    - "Notification settings page shows 2-3 grouped toggles instead of 9 individual toggles"
    - "Toggling a group sets all underlying DB columns in that group"
  artifacts:
    - path: "apps/web/app/(app)/my-rides/page.tsx"
      provides: "Single list My Rides without SubTab"
    - path: "apps/web/app/(app)/settings/notifications/page.tsx"
      provides: "Grouped notification toggles (push, email)"
  key_links:
    - from: "apps/web/app/(app)/settings/notifications/page.tsx"
      to: "supabase notification_preferences table"
      via: "Group toggle sets all push_* or email_* columns at once"
      pattern: "push_booking_requests.*push_booking_confirmations"
---

<objective>
Simplify My Rides page (remove upcoming/past sub-tabs, merge into single list) and notification settings (collapse 9 toggles into 2-3 grouped toggles).

Purpose: Reduce UI complexity for common user-facing pages per UX feedback.
Output: Simplified My Rides and notification settings pages.
</objective>

<execution_context>
@/Users/miakh/.claude/get-shit-done/workflows/execute-plan.md
@/Users/miakh/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-ui-polish-route-features/16-RESEARCH.md
@apps/web/app/(app)/my-rides/page.tsx
@apps/web/app/(app)/settings/notifications/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: My Rides single list without sub-tabs</name>
  <files>
    apps/web/app/(app)/my-rides/page.tsx
    packages/shared/src/i18n/translations/cs.ts
    packages/shared/src/i18n/translations/sk.ts
    packages/shared/src/i18n/translations/en.ts
  </files>
  <action>
    1. Read `my-rides/page.tsx` (524 lines). Understand the current structure: `TopTab` (driver/passenger) and `SubTab` (upcoming/past).
    2. **Keep** the `TopTab` (driver/passenger) tabs -- these stay.
    3. **Remove** the `SubTab` type, `subTab` state, and the sub-tab UI switcher buttons.
    4. **Merge** the filtering logic: instead of filtering into upcoming OR past based on `subTab`, create a single sorted list:
       - Separate rides into upcoming (departure >= now) and past (departure < now).
       - Sort upcoming rides by departure ascending (soonest first).
       - Sort past rides by departure descending (most recent first).
       - Concatenate: upcoming first, then past.
       - Optionally add a subtle visual separator (e.g., a small "Past rides" heading or divider) between the two groups if there are both upcoming and past rides.
    5. Remove any SubTab-related translation keys if they exist. Add new translation keys for the section divider if used (e.g., `myRides.pastRides`).
    6. The empty state should show when there are no rides at all for the selected top tab (not per sub-tab).
  </action>
  <verify>
    1. `npx tsc --noEmit` passes.
    2. Grep for `SubTab` or `subTab` in my-rides/page.tsx confirms removal.
    3. The file still has `TopTab` (driver/passenger) functionality.
  </verify>
  <done>
    My Rides page shows driver/passenger top tabs with a single sorted list (upcoming ascending, then past descending) in each tab. No sub-tab UI for upcoming/past.
  </done>
</task>

<task type="auto">
  <name>Task 2: Simplified notification settings with grouped toggles</name>
  <files>
    apps/web/app/(app)/settings/notifications/page.tsx
    packages/shared/src/i18n/translations/cs.ts
    packages/shared/src/i18n/translations/sk.ts
    packages/shared/src/i18n/translations/en.ts
  </files>
  <action>
    1. Read `settings/notifications/page.tsx` (286 lines). Understand the current 9 individual toggles.
    2. Replace the 9 individual toggle UI with 3 grouped toggles:
       - **Push Notifications** (master toggle): Controls `push_booking_requests`, `push_booking_confirmations`, `push_booking_cancellations`, `push_new_messages`, `push_ride_reminders`, `push_route_alerts`.
       - **Email Notifications** (master toggle): Controls `email_booking_confirmations`, `email_ride_reminders`, `email_cancellations`.
       - **Ride Reminders** (toggle): Controls `push_ride_reminders` and `email_ride_reminders` specifically.
    3. On load, compute group state:
       - Group is ON if ALL sub-values in the group are true.
       - Group is OFF if ALL sub-values are false.
       - If mixed, show as ON (because the user previously had granular control and some were on).
    4. On toggle, set ALL columns in the group to the new value via a single upsert.
    5. Add a brief description under each group toggle explaining what it controls (e.g., "Booking requests, confirmations, cancellations, messages, reminders, route alerts").
    6. Add translation keys for the grouped toggle labels and descriptions in all three locale files:
       - `notifications.pushGroup` / `notifications.pushGroupDesc`
       - `notifications.emailGroup` / `notifications.emailGroupDesc`
       - `notifications.remindersGroup` / `notifications.remindersGroupDesc`
    7. Keep the same Supabase upsert pattern used by the existing individual toggles -- just set multiple columns per toggle action.
  </action>
  <verify>
    1. `npx tsc --noEmit` passes.
    2. The page renders exactly 3 toggles (not 9).
    3. Each toggle's change handler sets multiple DB columns at once.
    4. Translation keys exist in all three locale files.
  </verify>
  <done>
    Notification settings page shows 3 grouped toggles (Push, Email, Reminders) that set multiple DB columns per toggle. Individual toggle UI is removed.
  </done>
</task>

</tasks>

<verification>
- TypeScript compiles without errors
- My Rides page has no SubTab references
- Notification settings has exactly 3 group toggles
- All new translation keys present in cs/sk/en
</verification>

<success_criteria>
- My Rides: single list per top tab, upcoming first then past, no sub-tab switcher
- Notifications: 3 grouped toggles replacing 9 individual ones
- All translations in place for new UI text
</success_criteria>

<output>
After completion, create `.planning/phases/16-ui-polish-route-features/16-02-SUMMARY.md`
</output>
