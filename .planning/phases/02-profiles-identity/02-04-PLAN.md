---
phase: 02-profiles-identity
plan: 04
type: execute
wave: 3
depends_on: ["02-02", "02-03"]
files_modified:
  - apps/web/app/(app)/profile/[id]/page.tsx
  - apps/mobile/app/profile/[id].tsx
  - apps/mobile/app/profile/_layout.tsx
  - apps/web/app/(app)/profile/page.tsx
  - apps/mobile/app/(tabs)/profile/index.tsx
autonomous: true

must_haves:
  truths:
    - "User can view another user's profile with their avatar, display name, bio, social links, vehicles, and ratings placeholder"
    - "Profile shows verification badge for phone-verified users and enhanced badge for ID-uploaded users"
    - "User can add and edit Instagram and Facebook links on their own profile"
    - "Own profile page shows a link to manage vehicles"
  artifacts:
    - path: "apps/web/app/(app)/profile/[id]/page.tsx"
      provides: "Public profile view page for web"
      contains: "is_phone_verified"
    - path: "apps/mobile/app/profile/[id].tsx"
      provides: "Public profile view screen for mobile"
      contains: "is_phone_verified"
  key_links:
    - from: "apps/web/app/(app)/profile/[id]/page.tsx"
      to: "supabase profiles + vehicles tables"
      via: "select with join"
      pattern: "from\\('profiles'\\)"
    - from: "apps/web/app/(app)/profile/page.tsx"
      to: "apps/web/app/(app)/vehicles/page.tsx"
      via: "Link to /vehicles"
      pattern: "href.*vehicles"
---

<objective>
Add verification badges, social profile linking, and public profile viewing.

Purpose: Users need to view other people's profiles to build trust before sharing rides (PROF-03, PROF-04, PROF-05, PROF-10). Verification badges and social links increase confidence.

Output: Public profile view pages on both platforms, verification badge display, social links editing on own profile, and vehicle section on own profile.
</objective>

<execution_context>
@/Users/miakh/.claude/get-shit-done/workflows/execute-plan.md
@/Users/miakh/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-profiles-identity/02-RESEARCH.md
@.planning/phases/02-profiles-identity/02-01-SUMMARY.md
@.planning/phases/02-profiles-identity/02-02-SUMMARY.md
@.planning/phases/02-profiles-identity/02-03-SUMMARY.md
@apps/web/app/(app)/profile/page.tsx
@apps/mobile/app/(tabs)/profile/index.tsx
@packages/shared/src/validation/profile.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add social links editing to own profile and create public profile view (web)</name>
  <files>
    apps/web/app/(app)/profile/page.tsx
    apps/web/app/(app)/profile/[id]/page.tsx
  </files>
  <action>
**Update apps/web/app/(app)/profile/page.tsx** -- Enhance own profile:
- Add social links fields to the edit form: Instagram URL and Facebook URL inputs. Use SocialLinksSchema for validation. Save as social_links JSONB column.
- Display social links in view mode as clickable icons/links (Instagram, Facebook) opening in new tab. Show only if URL is set.
- Add "My Vehicles" section below bio: show primary vehicle card (photo thumbnail, make + model) with "Manage Vehicles" link to /vehicles. If no vehicles, show "Add a vehicle to offer rides" link.
- Add verification badges next to display name:
  - Phone verified badge: call supabase.rpc('is_phone_verified', { user_id }) on profile load. Show checkmark icon + "Phone Verified" if true.
  - ID verified badge: check profile.id_verified. Show shield icon + "ID Verified" if true.
  - Style: small pill badges with pastel colors (green for phone, blue for ID)
- Add ID upload section (PROF-10): simple file input to upload ID document. Upload to a PRIVATE bucket approach -- for now, store in 'avatars' bucket under `${userId}/id-document-${Date.now()}.jpg` (not ideal but functional; can be moved to private bucket in polish phase). Set id_document_url and id_verified=true on profile. Note: in production, id_verified would require admin review, but for MVP upload = verified.

**Create apps/web/app/(app)/profile/[id]/page.tsx** -- View other user's profile:
- Server component or client component that fetches profile by route param `id`
- Fetch: supabase.from('profiles').select().eq('id', params.id).single()
- Also fetch: supabase.rpc('is_phone_verified', { user_id: params.id })
- Also fetch: supabase.from('vehicles').select().eq('owner_id', params.id).eq('is_primary', true).single() (show primary vehicle only)
- Display: avatar, display name, bio, social links (clickable), verification badges, primary vehicle card, ratings section with "No ratings yet" placeholder (rating_avg and rating_count exist but will be 0)
- Member since: format created_at date
- No edit controls (read-only view of another user)
- If profile not found: show 404-style message
  </action>
  <verify>
Run `cd /Users/miakh/source/festapp-rideshare && pnpm turbo build --filter=web` to verify build. Check that /profile shows social links and vehicles section. Check /profile/[some-id] renders another user's profile.
  </verify>
  <done>Own profile page has social links editing, vehicle section, verification badges, and ID upload. /profile/[id] shows another user's public profile with badges, social links, vehicle, and ratings placeholder.</done>
</task>

<task type="auto">
  <name>Task 2: Add social links editing to own profile and create public profile view (mobile)</name>
  <files>
    apps/mobile/app/(tabs)/profile/index.tsx
    apps/mobile/app/profile/_layout.tsx
    apps/mobile/app/profile/[id].tsx
  </files>
  <action>
**Update apps/mobile/app/(tabs)/profile/index.tsx** -- Enhance own profile:
- Same enhancements as web: social links editing (Instagram/Facebook URL TextInputs in edit mode), verification badges, vehicle section with link to /vehicles, ID upload via pickAndUploadAvatar-style function
- Social links display: tappable icons that open URLs via Linking.openURL
- Verification badges: same pill style as web, using theme colors
- Vehicle section: show primary vehicle thumbnail + "Manage Vehicles" button navigating to /vehicles

**Create apps/mobile/app/profile/_layout.tsx** -- Stack layout for profile routes:
- Simple Stack navigator for the profile/[id] route
- Header with back button, title "Profile"

**Create apps/mobile/app/profile/[id].tsx** -- View other user's profile:
- Read `id` from useLocalSearchParams
- Fetch profile, phone verification, primary vehicle (same queries as web)
- Display: avatar Image, display name, bio, social links (tappable via Linking.openURL), verification badges, vehicle card, ratings placeholder
- ScrollView layout
- Member since date
- If not found: "Profile not found" message
- Style with design tokens
  </action>
  <verify>
Run `cd /Users/miakh/source/festapp-rideshare && pnpm turbo build --filter=mobile` to verify build. Check that profile tab has social links and vehicle section. Check profile/[id] screen renders.
  </verify>
  <done>Mobile own profile has social links editing, vehicle section, verification badges. profile/[id] screen shows another user's public profile with all sections.</done>
</task>

</tasks>

<verification>
1. `pnpm turbo build` passes for both web and mobile
2. Own profile shows social links (editable), verification badges, vehicle section
3. /profile/[id] (web) and profile/[id] (mobile) show read-only public profile
4. Phone verification badge derives from is_phone_verified RPC
5. Social links open in new tab (web) or Linking.openURL (mobile)
6. Ratings section shows placeholder with existing rating_avg/rating_count columns
</verification>

<success_criteria>
- Users can add/edit Instagram and Facebook URLs on their profile
- Verification badges appear for phone-verified and ID-uploaded users
- Public profile view shows avatar, name, bio, social links, badges, vehicle, and ratings placeholder
- Vehicle section on own profile links to vehicle management
- Profile not found state is handled gracefully
</success_criteria>

<output>
After completion, create `.planning/phases/02-profiles-identity/02-04-SUMMARY.md`
</output>
