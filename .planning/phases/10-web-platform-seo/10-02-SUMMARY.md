---
phase: 10-web-platform-seo
plan: 02
subsystem: seo
tags: [open-graph, short-urls, sitemap, robots, ssr, social-preview, next-metadata]

# Dependency graph
requires:
  - phase: 01-foundation-auth
    provides: Supabase auth, middleware, server client
  - phase: 03-ride-creation-search
    provides: rides table, ride query builders
provides:
  - Short ID system for rides and profiles (6-char unambiguous IDs)
  - Public SSR ride page at /ride/{shortId} with full OG meta tags
  - Public SSR profile page at /u/{shortId} with OG meta
  - robots.txt and dynamic sitemap.xml
  - SEO constants (SITE_URL, SITE_NAME, SITE_DESCRIPTION, DEFAULT_OG_IMAGE)
  - Public route group layout (no auth required)
affects: [10-web-platform-seo, social-sharing, search-engine-indexing]

# Tech tracking
tech-stack:
  added: []
  patterns: [Next.js generateMetadata for OG tags, public route group with (public), short ID generation via PostgreSQL trigger]

key-files:
  created:
    - supabase/migrations/042_short_ids.sql
    - apps/web/lib/short-id.ts
    - packages/shared/src/constants/seo.ts
    - apps/web/app/(public)/layout.tsx
    - apps/web/app/(public)/ride/[shortId]/page.tsx
    - apps/web/app/(public)/u/[shortId]/page.tsx
    - apps/web/app/robots.ts
    - apps/web/app/sitemap.ts
  modified:
    - packages/shared/src/index.ts
    - packages/shared/src/types/database.ts
    - apps/web/lib/supabase/middleware.ts
    - apps/web/app/(app)/rides/[id]/page.tsx
    - apps/web/app/layout.tsx

key-decisions:
  - "Short IDs use 6-char unambiguous charset (abcdefghjkmnpqrstuvwxyz23456789) generated by PostgreSQL trigger"
  - "Public route group (public) has minimal header + CTA footer, no auth check"
  - "Canonical URLs on authenticated ride pages point to public short URLs for SEO consolidation"
  - "Default OG image placeholder used; future OG image API endpoint can replace it"

patterns-established:
  - "Public pages pattern: (public) route group with getRideByShortId/getProfileByShortId lookups"
  - "SEO metadata pattern: generateMetadata with openGraph, twitter card, canonical alternates"

# Metrics
duration: 3min
completed: 2026-02-16
---

# Phase 10 Plan 02: SSR Public Pages & SEO Summary

**SSR public ride/profile pages with OG meta tags, short URL system, robots.txt, and dynamic sitemap for social sharing and search engine indexing**

## Performance

- **Duration:** 3 min
- **Started:** 2026-02-16T00:45:16Z
- **Completed:** 2026-02-16T00:48:30Z
- **Tasks:** 2
- **Files modified:** 13

## Accomplishments
- Short ID system with PostgreSQL triggers auto-generating 6-char IDs for rides and profiles
- Public ride page at /ride/{shortId} with full OG meta (title, description, image, twitter card, canonical)
- Public profile page at /u/{shortId} with OG meta and verification badges
- robots.txt blocking private routes, dynamic sitemap listing active rides
- Canonical URL consolidation from authenticated pages to public short URLs

## Task Commits

Each task was committed atomically:

1. **Task 1: Short ID migration, generation utility, and public route group** - `f6ca8ce` (feat)
2. **Task 2: Public ride page with OG meta, public profile page, robots, sitemap** - `420782d` (feat)

## Files Created/Modified
- `supabase/migrations/042_short_ids.sql` - Short ID columns, generator function, triggers, backfill
- `apps/web/lib/short-id.ts` - getRideByShortId and getProfileByShortId query utilities
- `packages/shared/src/constants/seo.ts` - SITE_URL, SITE_NAME, SITE_DESCRIPTION, DEFAULT_OG_IMAGE
- `apps/web/app/(public)/layout.tsx` - Public layout with minimal header and signup CTA
- `apps/web/app/(public)/ride/[shortId]/page.tsx` - SSR ride page with full OG meta tags
- `apps/web/app/(public)/u/[shortId]/page.tsx` - SSR profile page with OG meta
- `apps/web/app/robots.ts` - robots.txt blocking /api/, /admin/, /settings/, etc.
- `apps/web/app/sitemap.ts` - Dynamic sitemap with ride pages and static pages
- `packages/shared/src/index.ts` - Re-export SEO constants
- `packages/shared/src/types/database.ts` - short_id on profiles and rides types
- `apps/web/lib/supabase/middleware.ts` - Added /ride/, /u/ to public routes
- `apps/web/app/(app)/rides/[id]/page.tsx` - Canonical URL and OG URL pointing to public short URL
- `apps/web/app/layout.tsx` - metadataBase, openGraph.siteName, openGraph.locale defaults

## Decisions Made
- Short IDs use 6-char unambiguous charset (no 0, 1, i, l, o) generated by PostgreSQL trigger on INSERT
- Public route group has minimal layout (header + CTA) without auth -- clean for crawlers and shared links
- Canonical URLs on authenticated ride pages point to public short URLs for SEO consolidation
- Default OG image placeholder used; a dedicated OG image generation endpoint can be added later

## Deviations from Plan
None - plan executed exactly as written.

## Issues Encountered
None

## User Setup Required
None - no external service configuration required.

## Next Phase Readiness
- Public pages ready for social sharing with rich previews
- Short URLs functional for all rides and profiles
- SEO infrastructure (robots, sitemap, OG meta) in place for search engine discovery

---
*Phase: 10-web-platform-seo*
*Completed: 2026-02-16*
